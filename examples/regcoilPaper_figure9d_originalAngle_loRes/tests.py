#!/usr/bin/env python

# This python script checks the output file for an example to 
# see if the results are close to expected values.  This script may be
# run directly, and it is also called when "make test" is run from the
# main BDISTRIB directory.

execfile('../testsCommon.py')

numFailures = 0

f = readOutputFile()

variableName = 'alpha'
data = f.variables[variableName][()]
desiredTolerance = 1e-12
numFailures += arrayShouldBe(data, [0, 1e-15, 1.33352143216332e-15, 1.77827941003892e-15,\
                                    2.37137370566166e-15, 3.16227766016838e-15, 4.21696503428582e-15,\
                                    5.62341325190349e-15, 7.49894209332456e-15, 1e-14],desiredTolerance)


variableName = 'chi2_B'
data = f.variables[variableName][()]
desiredTolerance = 0.03
# Skip the alpha=0 case, which is pathological, and make sure the other ones are within a few % of the high-res results:
numFailures += arrayShouldBe(data[1:], [0.174519878306313, 0.233148551834137, \
    0.310446213587783, 0.411565852326815, 0.542616084841207, \
    0.710568315783369, 0.922890554110523, 1.18673864681126, 1.50770781013225],desiredTolerance)

variableName = 'chi2_J'
data = f.variables[variableName][()]
desiredTolerance = 0.01
numFailures += arrayShouldBe(data[1:], [1.74957088182873e+15, 1.6989658516062e+15,\
    1.64892520707378e+15, 1.59982527129183e+15, 1.55209554042516e+15,\
    1.50621123410416e+15, 1.46269693947801e+15, 1.42212837760326e+15,\
    1.38509938973785e+15], desiredTolerance)

variableName = 'max_Bnormal'
data = f.variables[variableName][()]
desiredTolerance = 0.03
numFailures += arrayShouldBe(data[1:], [0.117555544291034, 0.134561224876993,\
    0.153923792979921, 0.176347144447289, 0.201603899107085,\
    0.229977435728317, 0.261839981656698, 0.296625161466877, 0.333988791941713], desiredTolerance)

variableName = 'max_J'
data = f.variables[variableName][()]
desiredTolerance = 0.06
numFailures += arrayShouldBe(data[1:], [ 8824481.60102707, 8355450.23653953,\
    7884212.39105115, 7412969.17310808, 6945281.57578389, 6485916.75531679,\
    6040435.92861007, 5614638.75966927, 5214018.48872153], desiredTolerance)

variableName = 'single_valued_current_potential_mn'
data = f.variables[variableName][()]
print data.shape
desiredTolerance = 1e-4
numFailures += arrayShouldBe(data[0,:], [-636481.60416242, -102835.333542226, -39124.0186294881, -6816.08113940242,
   542.692475698608, -2686.1108530638, -601.765971600708, 26.2180240803913,
    -150.847194134617, -58.2551976061389, 60.0317419077943, -15.997364372303,
    -12.3528609642142, -28.8468306445688, 120.907353313668, -90.444227136533,
    -254.610877079356, 117.750619995718, -586.859801429981,
    -3240.79714512101, -345.706420298433, -8000.93888813538,
    -33571.3281108956, -146463.897042633, 261525.559042215, 875162.411027093,
    223424.734276641, 48679.3704112507, 24653.0844662479, 3207.55972139988,
    -971.300457622961, 1735.36333359508, 392.289700069504, 58.3403278403076,
    69.2088816044866, 28.574277764148, -32.6049569184015, -3.19468817585156,
    18.9509927995784, 40.9417395029467, -191.329948990297, 102.505974883377,
    476.918019850139, -313.219021953551, 228.539785025719, 3535.38858987503,
    1994.33005106025, -2723.95384286104, 25378.8241944312, 211577.172631438,
    -509987.705552534, -305882.370067181, -64140.5967994057, 5526.489569249,
    -21143.6598694639, -1312.30942574156, 1256.40679971238,
    -866.753793091458, -323.218082280049, -62.4712285310379,
    -22.3887872985142, 11.572463519096, 18.8670999860767, 6.09601174794048,
    -39.626829330563, -58.1376718144676, 258.637725082145, -93.2264049514627,
    -690.771352763538, 137.091910375363, 618.390992293105, -2858.58032050993,
    -8887.84722613869, 18273.2756559291, 31254.1463773911, -183820.187349618,
    317263.663711709, 136546.037104119, 1714.17033452626, -6965.82579245848,
    19700.2927688041, 279.360825551664, -585.394321551508, 457.56013983205,
    247.414984963762, 36.063011937723, -2.88433594557794, -14.657242495135,
    -29.7277484867182, -5.15155109726196, 79.9609755678001, 96.2382594231763,
    -307.126611682774, -217.681183192655, 1164.78374124385, 1189.74972998963,
    -2200.7785485338, -901.659579742522, 18143.0098542936, -12823.6723296253,
    -18793.9927181867, 191936.052698242, -134572.41665727, -112479.974965958,
    -19248.1496384529, 8028.67003637305, -18917.5018103108, -663.00856123082,
    -130.269218689209, -359.598076210987, -121.339449458628,
    -42.6774334572464, 17.9474379704981, 23.4796365098314, 39.903936366997,
    6.71424592396383, -163.619373671154, -164.958633554062, 457.9492928255,
    929.023995244022, -2170.03690293255, -4109.54155806639, 4423.02245595864,
    11848.7759951353, -19183.4447881742, 20698.488290232, 98376.4092161681,
    -246652.945255868, 36177.2383322875, 120007.953328824, 11484.7657544551,
    -4712.15687254718, 17600.9544860059, -109.759176704224, 858.005478267692,
    250.801901773195, 112.595088965925, -29.0802679750806, -41.9900107268828,
    -32.446943536193, -50.3151682883662, -5.27400182515745, 314.549242682154,
    268.959151540374, -921.339292653633, -2110.06565879334, 4471.04983495344,
    8373.18809218046, -8063.05480853702, -24107.6728123965, 13542.8083194455,
    -49083.7639169206, -130918.200746624, 265974.857549389, 19277.1970752313,
    -94636.1096069281, -12455.6660070208, 205.614622738596,
    -13352.0580607509, 88.0140555713081, -751.856883151767, -231.62025244395,
    24.2787971083689, 79.1321103557964, 68.1790577884637, 33.0664705300337,
    62.1791798540125, -8.96468981509356, -551.338416161408   ],desiredTolerance,requireSameLength=False)


f.close()
print "numFailures:",numFailures
exit(numFailures > 0)
