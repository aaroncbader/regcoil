#!/usr/bin/env python

# This python script checks the output file for an example to 
# see if the results are close to expected values.  This script may be
# run directly, and it is also called when "make test" is run from the
# main BDISTRIB directory.

execfile('../testsCommon.py')

numFailures = 0

f = readOutputFile()

variableName = 'alpha'
data = f.variables[variableName][()]
desiredTolerance = 1e-12
numFailures += arrayShouldBe(data, [0, 1e-15, 1.33352143216332e-15, 1.77827941003892e-15,\
                                    2.37137370566166e-15, 3.16227766016838e-15, 4.21696503428582e-15,\
                                    5.62341325190349e-15, 7.49894209332456e-15, 1e-14],desiredTolerance)


variableName = 'chi2_B'
data = f.variables[variableName][()]
desiredTolerance = 1e-4
numFailures += arrayShouldBe(data, [1.03212977803779e-07, 0.174519878306313, 0.233148551834137, \
    0.310446213587783, 0.411565852326815, 0.542616084841207, \
    0.710568315783369, 0.922890554110523, 1.18673864681126, 1.50770781013225],desiredTolerance)

variableName = 'chi2_J'
data = f.variables[variableName][()]
desiredTolerance = 1e-4
numFailures += arrayShouldBe(data, [2.11677434509126e+27, 1.74957088182873e+15, 1.6989658516062e+15,\
    1.64892520707378e+15, 1.59982527129183e+15, 1.55209554042516e+15,\
    1.50621123410416e+15, 1.46269693947801e+15, 1.42212837760326e+15,\
    1.38509938973785e+15], desiredTolerance)

variableName = 'max_Bnormal'
data = f.variables[variableName][()]
desiredTolerance = 1e-4
numFailures += arrayShouldBe(data, [0.000303843956012018, 0.117555544291034, 0.134561224876993,\
    0.153923792979921, 0.176347144447289, 0.201603899107085,\
    0.229977435728317, 0.261839981656698, 0.296625161466877, 0.333988791941713], desiredTolerance)

variableName = 'max_J'
data = f.variables[variableName][()]
desiredTolerance = 1e-4
numFailures += arrayShouldBe(data, [69829666253268.8, 8824481.60102707, 8355450.23653953,\
    7884212.39105115, 7412969.17310808, 6945281.57578389, 6485916.75531679,\
    6040435.92861007, 5614638.75966927, 5214018.48872153], desiredTolerance)

variableName = 'single_valued_current_potential_mn'
data = f.variables[variableName][()]
print data.shape
desiredTolerance = 1e-4
numFailures += arrayShouldBe(data[0,:], [-766905013.080148, 493479937.721139, 157782419.719183, -375238845.599734,
    145992436.560096, 80445379.5139643, -105500153.311093, 2510347.03222869,
    9384582.60153099, 7080518.3229238, 5870678.55253053, -16827626.8065945,
    -8076236.42045331, -5376196.68648354, -7411740.95302288,
    -2661535.40616481, -2356294.44277728, -5700226.58750368,
    -7464670.00905926, -6935775.22878549, -5297602.4961336,
    -3303084.52355178, -1462691.74220133, -424953.972792615,
    -354651.97325869, -515908.298291184, -429171.944965849,
    -200195.051216089, -24477.7603047295, 37753.3138639317, 18108.220559334,
    6913.44125820062, -2496.31436493209, 11635.1685441279, 47434.351522327,
    41418.3317683034, -47662.212801605, -245545.702970702, -461057.523853197,
    -483824.431071713, -205780.224632469, -274378.182799369,
    -1500754.67681218, -3521723.05353299, -5384447.28032143,
    -6516880.99134312, -6690630.0036753, -4816865.1735591, -1190648.81010299,
    -2483442.01917139, -8424881.66058055, -4454819.9703418,
    -7305511.15590682, -11890069.3368974, 11295603.2501911,
    -859686.681684175, 26601465.4839915, 6113948.38673841, -143187608.538165,
    152020812.299219, 158150228.449938, -479578906.344744, 297250182.851727,
    454928388.484248, -865288946.220258, 184219282.88079, 619708818.927469,
    -478475258.367304, -56658706.2349376, 290582848.731904,
    -123087070.978483, -33983006.2160578, 76587468.7947121, 1945455.96751467,
    -11685.5356636677, -9654890.96662199, -44087.8277880025,
    18982843.9527627, 7968932.10058541, 5274849.34193258, 6253673.495256,
    2796724.58390202, 3269984.09089071, 6255475.48490629, 7643922.62860067,
    6729403.72865468, 4837503.70394182, 2915922.49085721, 1355333.68571452,
    511722.124519776, 420828.251130951, 476270.337641606, 341144.502501053,
    136084.101414903, 3051.11567777269, -17608.2719824828, -14735.7590256216,
    10454.9940878668, 3659.48349014465, -40629.0835267282, -67937.8723715603,
    -46283.432447799, 57157.2205594846, 238509.499779766, 407426.242776741,
    355057.655239321, -18305.2774306739, 59238.8872063241, 1426925.01255405,
    3526074.88654265, 5033997.92195143, 5480176.75431792, 5523263.27890417,
    3838232.96923849, -161435.279360664, 2219147.36608251, 8884133.79343245,
    2665826.45898861, 6146826.67223952, 4164516.24922038, -13867886.2541533,
    14331908.2586385, -54372895.94165, -2288134.80121055, 187473699.236905,
    -250088473.27439, -140332937.960664, 586281108.188605, -455484190.351799,
    -362291202.002261, 856775992.322692, -291287794.743081,
    -481037983.087711, 442617061.308424, -14515898.7098526,
    -225126468.437563, 103713761.437321, 5136561.94777516, -54636324.2153188,
    -3819362.74481476, -4877043.51409082, 8662617.58139164,
    -4627290.91501434, -18504076.1690529, -6883771.72743367,
    -4601192.43314433, -5075665.2561007, -2936593.46615509, -3816470.6662757,
    -6292968.9490205, -7193999.20426337, -6017255.90653972,
    -4114250.39263739, -2452382.39619713, -1198739.36609183,
    -532542.384518725, -416209.434474626, -380011.818644514],desiredTolerance,requireSameLength=False)


f.close()
print "numFailures:",numFailures
exit(numFailures > 0)
